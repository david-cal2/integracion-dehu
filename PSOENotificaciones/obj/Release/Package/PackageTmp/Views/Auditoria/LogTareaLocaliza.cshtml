@{
    ViewBag.Title = "LogTareaLocaliza";
}

<div class="gn-body">
    <div class="gn-body-wrapper">
        <div class="body-aside">
            <div class="aside-wrapper">
                <aside class="aside">
                    <nav class="main-nav menu-lateral">
                        <ul>
                            <li id="item-menu-notificaciones-estado-1">
                                <a id="liSinAsignar" href="~/Auditoria/AuditoriaEnvio">
                                    <span class="nav_item nav_item__appeared"></span>
                                    <span class="nav_text">Auditoria Envío</span>
                                </a>
                            </li>
                            <li id="item-menu-notificaciones-estado-2">
                                <a id="liEnAlerta" href="~/Auditoria/EjecutarTareas">
                                    <span class="nav_item nav_item__appeared"></span>
                                    <span class="nav_text">Ejecutar Tareas</span>
                                </a>
                            </li>
                            <li id="item-menu-notificaciones-estado-3">
                                <a id="liAsignadas" href="~/Auditoria/ListadoExcepciones">
                                    <span class="nav_item nav_item__appeared"></span>
                                    <span class="nav_text">Listado Excepciones</span>
                                </a>
                            </li>
                            <li id="item-menu-notificaciones-estado-4">
                                <a id="liComparecidas" href="~/Auditoria/LogTareaLocaliza">
                                    <span class="nav_item nav_item__appeared"></span>
                                    <span class="nav_text">Log Tarea Localiza</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </aside>
            </div>
        </div>
        <div class="body-main">
            <main class="body-main-wrapper">
                <div class="main-section">
                    <div class="container-fluid px-2">
                        <div class="content_title">
                            <h1>Horario de ejecución automática de la tarea localiza en el día de hoy</h1>
                        </div>
                        <div class="table_container">
                            <div class="table_container__wrapper">
                                <div id="contenedor-logs"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>

<script>
    $(function () {
        $.ajax({
            async: false,
            type: 'GET',
            contentType: 'application/json; charset=utf-8',
            url: '/Auditoria/GetLogTareaLocaliza',
            dataType: "json",
            success: function (data) {
                if (data.hasOwnProperty('responseText')) {
                    toastr.error("Error en la llamada al servicio 'GetLogTareaLocaliza'");
                }
                else {
                    var contador = 1;
                    var codigoLista = "";
                    for (var i = 0; i < data.ListaLogs.length; i++) {
                        if (data.ListaLogs[i].Mensaje == "EJECUCIÓN PSOE_Tarea_Localiza") {
                            if (contador == 1) {
                                codigoLista += "<ul style='width: 100 %; height: 40px;'>";
                            }

                            if ((i + 1) < data.ListaLogs.length) {
                                if (data.ListaLogs[i + 1].Mensaje == "INICIO 'Proceso Localiza' - AUTOMÁTICO") {
                                    codigoLista += "<li style='float: left;'><div style='margin: 5px; padding: 5px; border: solid; border-color: black; border-radius: 5px; width: 80px; background-color: green; color: white;'><span>" + dateFormatTiempo(data.ListaLogs[i].Fecha) + "</span></div></li>";
                                }
                                else {
                                    codigoLista += "<li style='float: left;'><div style='margin: 5px; padding: 5px; border: solid; border-color: black; border-radius: 5px; width: 80px;'><span>" + dateFormatTiempo(data.ListaLogs[i].Fecha) + "</span></div></li>";
                                }
                            }
                            else
                                codigoLista += "<li style='float: left;'><div style='margin: 5px; padding: 5px; border: solid; border-color: black; border-radius: 5px; width: 80px;'><span>" + dateFormatTiempo(data.ListaLogs[i].Fecha) + "</span></div></li>";

                            if (contador == 4) {
                                codigoLista += "</ul>";
                                contador = 1;
                            }
                            else {
                                contador++;
                            }
                        }
                    }
                    $("#contenedor-logs")[0].innerHTML = codigoLista;
                }
            },
            error: function (data) {
                toastr.error("Error en la llamada al servicio 'GetLogTareaLocaliza'");
            }
        });
    })
</script>

