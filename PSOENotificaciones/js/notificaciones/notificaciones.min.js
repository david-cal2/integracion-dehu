var $inputIdentificador = $("#inputIdentificador"), $selectAdministracionPublica = $("#selectAdministracionPublica"), $selectOrganismosRaiz = $("#selectOrganismosRaiz"), $selectOrganismosEmisores = $("#selectOrganismosEmisores"), $selectEstados = $("#selectEstados"), $selectAsuntos = $("#selectAsuntos"), $selectGrupos = $("#selectGrupos"), $selectGruposModal = $("#selectGruposModal");
$(function () {
    function m() { var c = []; if (idPerfil == Perfiles.Administrador || idPerfil == Perfiles.UsuarioConsulta) c.push(Estados.SinAsignar), c.push(Estados.EnAlerta), c.push(Estados.Asignadas), c.push(Estados.Comparecidas), c.push(Estados.Caducadas), c.push(Estados.Externas); idPerfil == Perfiles.Asignador && c.push(Estados.SinAsignar); idPerfil == Perfiles.Gestor && (c.push(Estados.EnAlerta), c.push(Estados.Asignadas), c.push(Estados.Comparecidas), c.push(Estados.Caducadas)); return c } (function () {
        var c = $("#btn-notificaciones-estado-1"),
        l = $("#btn-notificaciones-estado-2"), g = $("#btn-notificaciones-estado-3"), b = $("#btn-notificaciones-estado-4"), d = $("#btn-notificaciones-estado-5"), f = $("#btn-notificaciones-estado-7"); idPerfil == Perfiles.Asignador && (l.addClass("no-visible"), g.addClass("no-visible"), b.addClass("no-visible"), d.addClass("no-visible"), f.addClass("no-visible")); idPerfil == Perfiles.Gestor && c.addClass("display-none")
    })(); $(document).ready(function () {
        function c() {
            idPerfil != Perfiles.Asignador && idPerfil != Perfiles.UsuarioConsulta ||
            $(".btn-comparecer").addClass("display-none"); idPerfil != Perfiles.Gestor && idPerfil != Perfiles.UsuarioConsulta || $(".btn-abrir-modal-asignar-grupo").addClass("display-none"); idPerfil != Perfiles.Gestor && idPerfil != Perfiles.Asignador || $("#div-asignada").addClass("display-none")
        } function l() {
            for (var b = "", d = document.querySelectorAll("#gruposAsignados li"), f = 0; li = d[f]; f++)b += li.id + ","; $.ajax({
                async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Notificaciones/AsignarGrupoEnvio", data: {
                    identificador: identificadorAsignar,
                    idGrupos: b
                }, dataType: "json", success: function (a) { "True" == a.Success ? ($(".cadena-" + identificadorAsignar)[0].innerText = a.cadenaGrupos, g(), c()) : ($("#overlay").hide(), toastr.error("Error en la llamada al servicio 'AsignarGrupoEnvio'")) }, error: function (a) { $("#overlay").hide(); toastr.error("Error en la llamada al servicio 'AsignarGrupoEnvio'") }
            })
        } function g(b) {
            var d = "/Notificaciones/GetNotificacionesBuscadorComplejo", f = !1; null == b && (f = !0, d = "/Notificaciones/GetNotificaciones", b = { idEstados: JSON.stringify(m()) });
            $.ajax({
                async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: d, data: b, dataType: "json", success: function (a) {
                    if (a.hasOwnProperty("responseText")) $("#overlay").hide(), toastr.error("Error en la llamada al servicio '" + d + "'"); else {
                        if (f && null != a.CantidadesTotales) {
                            var e = $("#cantSinAsignar"), h = $("#cantEnAlerta"), k = $("#cantAsignadas"), n = $("#cantComparecidas"), p = $("#cantCaducadas"), q = $("#cantExternas"); e[0].innerHTML = a.CantidadesTotales[0].Value; h[0].innerHTML = a.CantidadesTotales[1].Value; k[0].innerHTML =
                                a.CantidadesTotales[2].Value; n[0].innerHTML = a.CantidadesTotales[3].Value; p[0].innerHTML = a.CantidadesTotales[4].Value; q[0].innerHTML = a.CantidadesTotales[6].Value; $("#tituloPantallaInicio")[0].innerHTML = "Notificaciones recibidas en los \u00faltimos " + a.NumeroUltimosDias + " d\u00edas"
                        } e = $("#collapseOne"); h = $("#div-contenedor"); k = $("#div-contenedor-vacio"); null != a.ListaEnvios && 0 < a.ListaEnvios.length ? (h.removeClass("display-none"), k.addClass("display-none"), e = $("#table"), e.bootstrapTable("removeAll"), e.bootstrapTable("load",
                            a.ListaEnvios), export_fileName = "Notificaciones", $("#regPagina").innerText = "Notificaciones por p\u00e1gina") : (e.removeClass("collapse"), k.removeClass("display-none"), h.addClass("display-none")); $("#overlay").hide()
                    }
                }, error: function (a) { $("#overlay").hide(); toastr.error("Error en la llamada al servicio '" + d + "'") }
            })
        } setTimeout(cargarSelectAdministracionPublica, 500); setTimeout(cargarSelectEstados, 500); setTimeout(cargarSelectAsuntos, 500); setTimeout(cargarSelectGrupos, 500); g(); c(); $("#btn-buscar").click(function (b) {
            b.preventDefault();
            "" == $selectEstados.val() && "" == $inputIdentificador.val() && "" == $selectAdministracionPublica.val() && "" == $selectOrganismosRaiz.val() && "" == $selectOrganismosEmisores.val() && "" == $selectAsuntos.val() && "" == $selectGrupos.val() && "" == $fechaDesde.val() && "" == $fechaHasta.val() ? setTimeout(g, 1) : (b = {
                idEstados: "" == $selectEstados.val() ? JSON.stringify(m()) : $selectEstados.val(), identificador: "" == $inputIdentificador.val() ? null : $inputIdentificador.val(), administracionPublica: "" == $selectAdministracionPublica.val() ? null : $selectAdministracionPublica.val(),
                organismoRaiz: "" == $selectOrganismosRaiz.val() ? null : $selectOrganismosRaiz.val(), idOrganoEmisor: "" == $selectOrganismosEmisores.val() ? null : $selectOrganismosEmisores.val(), asunto: "" == $selectAsuntos.val() ? null : $selectAsuntos.val(), idGrupo: "" == $selectGrupos.val() ? null : $selectGrupos.val(), fechaDesde: "" == $fechaDesde.val() ? null : $fechaDesde.val(), fechaHasta: "" == $fechaHasta.val() ? null : $fechaHasta.val()
            }, setTimeout(g, 1, b)); $("#overlay").show()
        }); $("#btn-limpiar").click(function (b) {
            $("#inputIdentificador")[0].value =
            ""; $("#selectAdministracionPublica").selectpicker("val", ""); cargarSelectOrganismoRaiz(""); cargarSelectOrganismosEmisores(""); $("#selectEstados").selectpicker("val", ""); $("#selectAsuntos").selectpicker("val", ""); $("#selectGrupos").selectpicker("val", ""); $("#fechaDesde")[0].value = ""; $("#fechaHasta")[0].value = ""
        }); $("#table").on("dbl-click-cell.bs.table", function (b, d, f, a) {
            window.location.href = a.EstadosEnvio.ID != Estados.Comparecidas ? "../Notificaciones/NotificacionDetalle?identificador=" + a.Identificador +
                "&c=0" : "../Notificaciones/NotificacionComparecida?identificador=" + a.Identificador
        }); $("#btn-agregar-grupo").click(function (b) {
            b = $("#selectGruposModal").val(); if ("" != b) {
                for (var d = 1, f = document.querySelectorAll("#gruposAsignados li"), a = 0; li = f[a]; a++)li.id == b && (d = 0); 1 == d && $.ajax({
                    async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Base/GetGrupoById", data: { idGrupo: b }, dataType: "json", success: function (e) {
                        $("#gruposAsignados").append("<li id='" + e.ID + "'><strong class='eliminar-grupo' title='Quitar' onclick=\"javascript:eliminarGrupoAsignado('" +
                            e.ID + "')\">X</strong>" + e.Nombre + "</li>")
                    }, error: function (e) { toastr.error("Error en la llamada al servicio 'GetGrupoById'") }
                })
            }
        }); $("#btn-guardar-grupos").click(function (b) { b.preventDefault(); $("#asignarGrupoModal").modal("hide"); setTimeout(l, 1); $("#overlay").show() })
    })
});