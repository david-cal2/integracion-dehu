$(function () {
    function l() {
        $.ajax({
            async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Comunicaciones/GetCantidadEnviosLeida", dataType: "json", success: function (a) {
                null != a.CantidadesTotales && ($("#cantSinAsignar")[0].innerHTML = 99 < a.CantidadesTotales[0].Value ? "<span>+</span>99" : a.CantidadesTotales[0].Value, $("#cantAsignadas")[0].innerHTML = 99 < a.CantidadesTotales[2].Value ? "<span>+</span>99" : a.CantidadesTotales[2].Value, $("#cantLeidas")[0].innerHTML = 99 < a.CantidadesTotales[5].Value ? "<span>+</span>99" :
                    a.CantidadesTotales[5].Value)
            }, error: function (a) { toastr.error("Error en la llamada al servicio 'GetCantidadEnviosLeida'") }
        })
    } function m() { $.ajax({ async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Base/GetRespuestaAcceso", data: { identificador: identificador }, dataType: "json", success: function (a) { a.hasOwnProperty("responseText") ? toastr.error("Error en la llamada al servicio 'GetRespuestaAcceso'") : $("#fechaAcceso")[0].innerHTML = dateFormat(a.Fecha) }, error: function (a) { toastr.error("Error en la llamada al servicio 'GetRespuestaAcceso'") } }) }
    function n() {
        $.ajax({
            async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Comunicaciones/GetComunicacionDetalle", data: { identificador: identificador }, dataType: "json", success: function (a) {
                a.hasOwnProperty("responseText") ? (toastr.error("Error en la llamada al servicio 'GetComunicacionDetalle'"), window.location.href = "../Comunicaciones/Comunicaciones") : (null != a.ErrorCodigo && (d = a.ErrorDescripcion), null != a.ErrorMetodo && (e = a.ErrorMetodo), $("#fechaDisposicion")[0].innerHTML = dateFormat(a.FechaPuestaDisposicion),
                    $("#identificador")[0].innerHTML = a.Identificador, $("#asunto")[0].innerHTML = a.Concepto, $("#titular")[0].innerHTML = a.Personas.NombreTitular, $("#organismoEmisor")[0].innerHTML = a.OrganismosEmisores.OrganismoEmisor, $("#vinculo")[0].innerHTML = a.Vinculos.Descripcion, $("#organismoEmisorRaiz")[0].innerHTML = a.OrganismosEmisores.OrganismoRaiz, $("#descripcion")[0].innerHTML = a.Descripcion, $("#textMultiObservaciones")[0].value = a.Observaciones, null != a.MetadatosPublicos && "" != a.MetadatosPublicos ? $("#metadatosPublicos")[0].innerHTML =
                        decodeURIComponent(escape(window.atob(a.MetadatosPublicos))) : $("#div-metadatos-publicos").addClass("display-none"))
            }, error: function (a) { toastr.error("Error en la llamada al servicio 'GetComunicacionDetalle'") }
        })
    } function k() {
        $.ajax({
            async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Comunicaciones/GetContenidosDocumentos", data: { identificador: identificador, idRespuestaAcceso: idRespuestaAcceso }, dataType: "json", success: function (a) {
                if (a.hasOwnProperty("responseText")) toastr.error("Error en la llamada al servicio 'GetContenidosDocumentos'");
                else {
                    if (null != a.DetalleDocumento) {
                        null != a.DetalleDocumento.Metadatos && ($("#metadatosPrivados")[0].innerHTML = decodeURIComponent(escape(window.atob(a.DetalleDocumento.Metadatos)))); var b = f(a.DetalleDocumento.MimeType); null != a.DetalleDocumento.EnlaceDocumento && "" != a.DetalleDocumento.EnlaceDocumento && ($("#linkDocEnlace")[0].innerHTML = "<span class='document " + b + "'></span>Documento", $("#linkDocEnlace")[0].code = a.DetalleDocumento.EnlaceDocumento, $("#linkDocRef").addClass("display-none")); null != a.Contenido &&
                            "" != a.Contenido && ($("#linkDocEnlace").addClass("display-none"), $("#linkDocRef")[0].innerHTML = "<span class='document " + b + "'></span>Documento", $("#linkDocRef")[0].setAttribute("code", "data:" + a.DetalleDocumento.MimeType + ";base64," + encodeURI(a.Contenido.Href)))
                    } if (null != a.ListaAnexosUrl && 0 < a.ListaAnexosUrl.length) for (b = 0; b < a.ListaAnexosUrl.length; b++) {
                        var c = a.ListaAnexosUrl[b], g = b; if (null != c) {
                            var h = f(c.MimeType); c = "<li><a id='linkDocAnexoUrl-" + g + "' class='doc-link doc-ref doc-enlace' code='" + c.EnlaceDocumento +
                                "' href='javascript:void(0);' title='Ver documento' target='_blank'><span class='document " + h + "'></span>" + c.Nombre + "</a></li>"; $("#contenedor-anexos").innerHTML = $("#contenedor-anexos").innerHTML + c
                        }
                    } if (null != a.ListaAnexosReferencia && 0 < a.ListaAnexosReferencia.length) for (b = 0; b < a.ListaAnexosReferencia.length; b++)c = a.ListaAnexosReferencia[b], g = b, null != c.DocAnexo && null != c.ContenidoAnexo && (h = f(c.DocAnexo.MimeType), c = "<li><a id='linkDocAnexoRef-" + g + "' class='doc-link doc-ref' onclick='javascript:abrirAnexo(this);' href='' title='Ver documento' code='data:" +
                        c.DocAnexo.MimeType + ";base64," + encodeURI(c.ContenidoAnexo.Value) + "'><span class='document " + h + "'></span>" + c.DocAnexo.Nombre + "</a></li>", $("#contenedor-anexos")[0].innerHTML = $("#contenedor-anexos")[0].innerHTML + c); "" != e && ("SOLICITUD DE ANEXOS DE REFERENCIA" == e ? $("#btnLlamarAnexos").removeClass("display-none") : $("#btnLlamarAnexos").addClass("display-none")); null != a.ListaAnexosUrl.length && 0 != a.ListaAnexosUrl.length || null != a.AnexosRefAcceso && 0 != a.AnexosRefAcceso.length || $("#titulo-anexos").addClass("display-none");
                    null != a.AnexosRefAcceso && 0 < a.AnexosRefAcceso.length && (null == a.ListaAnexosReferencia || 0 == a.ListaAnexosReferencia.length) && $("#btnLlamarAnexos").removeClass("display-none")
                }
            }, error: function (a) { toastr.error("Error en la llamada al servicio 'GetContenidosDocumentos'") }
        })
    } function f(a) { if ("application/pdf" == a) return "doc_doc"; if ("application/zip" == a) return "doc_zip"; if ("text/html" == a) return "doc_file" } function p() {
        $.ajax({
            async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Comunicaciones/LlamarAnexos",
            data: { identificador: identificador }, dataType: "json", success: function (a) { $("#overlay").hide(); a.hasOwnProperty("responseText") ? toastr.error("Error en la llamada al servicio 'LlamarAnexos'") : k() }, error: function (a) { $("#overlay").hide(); toastr.error("Error en la llamada al servicio 'LlamarAnexos'") }
        })
    } (function () {
        var a = $("#item-menu-comunicaciones-estado-1"), b = $("#item-menu-comunicaciones-estado-3"), c = $("#item-menu-comunicaciones-estado-6"); idPerfil == Perfiles.Asignador && (b.addClass("no-visible"), c.addClass("no-visible"));
        idPerfil == Perfiles.Gestor && a.addClass("display-none"); $(".menu-lateral").removeClass("no-visible")
    })(); var d = "", e = ""; $(document).ready(function () {
        l(); m(); n(); k(); "1" == leer && ("0" == errorNet ? "0" == errorConectarDehu ? "" != d ? "Could not send Message." == d || "3009 No se ha podido recuperar el documento" == d ? ($("#msg-status")[0].innerHTML = d, $("#modalErrorDehu").modal("show")) : "4210 No se puede acceder a una comunicaci\u00f3n ya le\u00edda" == d ? $("#modalYaComparecida").modal("show") : ($("#msg-error")[0].innerHTML =
            d, $("#msg-error-metodo")[0].innerHTML = e, $("#modalComparecidaConErrores").modal("show")) : "200" == status && "0" != idRespuestaAcceso ? $("#modalComparecida").modal("show") : ($("#msg-status")[0].innerHTML = "Status: " + status, $("#modalErrorDehu").modal("show")) : $("#modalErrorDehu").modal("show") : $("#modalErrorNet").modal("show"))
    }); $("#textMultiObservaciones").change(function (a) {
        $.ajax({
            async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Notificaciones/SetObservaciones", data: {
                identificador: identificador,
                observaciones: $(this)[0].value
            }, dataType: "json", success: function (b) { b.hasOwnProperty("responseText") && toastr.error("Error en la llamada al servicio 'SetObservaciones'") }, error: function (b) { toastr.error("Error en la llamada al servicio 'SetObservaciones'") }
        })
    }); $(".doc-ref").click(function (a) {
        var b = window.open("about:blank"); b.document.body.appendChild(b.document.createElement("iframe")).src = a.target.getAttribute("code"); b.document.body.style.margin = 0; b.document.getElementsByTagName("iframe")[0].style.width =
            "100%"; b.document.getElementsByTagName("iframe")[0].style.height = "100%"; b.document.getElementsByTagName("iframe")[0].style.border = 0; a.preventDefault()
    }); $(".doc-enlace").click(function (a) { a.preventDefault(); url_enlace = a.target.code; $("#modalAbrirEnlace").modal("show") }); $("#btnLlamarAnexos").click(function (a) { $("#overlay").show(); setTimeout(p, 1E3) })
});