var $inputIdentificador = $("#inputIdentificador"), $selectAdministracionPublica = $("#selectAdministracionPublica"), $selectOrganismosRaiz = $("#selectOrganismosRaiz"), $selectOrganismosEmisores = $("#selectOrganismosEmisores"), $selectEstados = $("#selectEstados"), $selectAsuntos = $("#selectAsuntos"), $selectGrupos = $("#selectGrupos"), $selectGruposModal = $("#selectGruposModal");
$(function () {
    function l() { var c = []; if (idPerfil == Perfiles.Administrador || idPerfil == Perfiles.UsuarioConsulta) c.push(Estados.SinAsignar), c.push(Estados.Asignadas), c.push(Estados.Leidas); idPerfil == Perfiles.Asignador && c.push(Estados.SinAsignar); idPerfil == Perfiles.Gestor && (c.push(Estados.Asignadas), c.push(Estados.Leidas)); return c } (function () {
        var c = $("#btn-comunicaciones-estado-1"), k = $("#btn-comunicaciones-estado-3"), g = $("#btn-comunicaciones-estado-6"); idPerfil == Perfiles.Asignador && (k.addClass("no-visible"),
            g.addClass("no-visible")); idPerfil == Perfiles.Gestor && c.addClass("display-none")
    })(); $(document).ready(function () {
        function c() { idPerfil != Perfiles.Asignador && idPerfil != Perfiles.UsuarioConsulta || $(".btn-comparecer").addClass("display-none"); idPerfil != Perfiles.Gestor && idPerfil != Perfiles.UsuarioConsulta || $(".btn-abrir-modal-asignar-grupo").addClass("display-none"); idPerfil != Perfiles.Gestor && idPerfil != Perfiles.Asignador || $("#div-asignada").addClass("display-none") } function k() {
            for (var b = "", e = document.querySelectorAll("#gruposAsignados li"),
                f = 0; li = e[f]; f++)b += li.id + ","; $.ajax({ async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Notificaciones/AsignarGrupoEnvio", data: { identificador: identificadorAsignar, idGrupos: b }, dataType: "json", success: function (a) { "True" == a.Success ? ($(".cadena-" + identificadorAsignar)[0].innerText = a.cadenaGrupos, g(), c()) : ($("#overlay").hide(), toastr.error("Error en la llamada al servicio 'AsignarGrupoEnvio'")) }, error: function (a) { $("#overlay").hide(); toastr.error("Error en la llamada al servicio 'AsignarGrupoEnvio'") } })
        }
        function g(b) {
            var e = "/Comunicaciones/GetComunicacionesBuscadorComplejo", f = !1; null == b && (f = !0, e = "/Comunicaciones/GetComunicaciones", b = { idEstados: JSON.stringify(l()) }); $.ajax({
                async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: e, data: b, dataType: "json", success: function (a) {
                    if (a.hasOwnProperty("responseText")) $("#overlay").hide(), toastr.error("Error en la llamada al servicio '" + e + "'"); else {
                        if (f && null != a.CantidadesTotales) {
                            var d = $("#cantSinAsignar"), h = $("#cantAsignadas"), m = $("#cantLeidas");
                            d[0].innerHTML = a.CantidadesTotales[0].Value; h[0].innerHTML = a.CantidadesTotales[2].Value; m[0].innerHTML = a.CantidadesTotales[5].Value; $("#tituloPantallaInicio")[0].innerHTML = "Comunicaciones recibidas en los \u00faltimos " + a.NumeroUltimosDias + " d\u00edas"
                        } d = $("#div-contenedor"); h = $("#div-contenedor-vacio"); null != a.ListaEnvios && 0 < a.ListaEnvios.length ? (d.removeClass("display-none"), h.addClass("display-none"), d = $("#table"), d.bootstrapTable("removeAll"), d.bootstrapTable("load", a.ListaEnvios), export_fileName =
                            "Comunicaciones", $("#regPagina").text("Comunicaciones por p\u00e1gina")) : (h.removeClass("display-none"), d.addClass("display-none")); $("#overlay").hide()
                    }
                }, error: function (a) { $("#overlay").hide(); toastr.error("Error en la llamada al servicio '" + e + "'") }
            })
        } setTimeout(cargarSelectAdministracionPublica, 500); setTimeout(cargarSelectEstados, 500); setTimeout(cargarSelectAsuntos, 500); setTimeout(cargarSelectGrupos, 500); g(); c(); $("#btn-buscar").click(function (b) {
            b.preventDefault(); "" == $selectEstados.val() && "" ==
                $inputIdentificador.val() && "" == $selectAdministracionPublica.val() && "" == $selectOrganismosRaiz.val() && "" == $selectOrganismosEmisores.val() && "" == $selectAsuntos.val() && "" == $selectGrupos.val() && "" == $fechaDesde.val() && "" == $fechaHasta.val() ? setTimeout(g, 1) : (b = {
                    idEstados: "" == $selectEstados.val() ? JSON.stringify(l()) : $selectEstados.val(), identificador: "" == $inputIdentificador.val() ? null : $inputIdentificador.val(), administracionPublica: "" == $selectAdministracionPublica.val() ? null : $selectAdministracionPublica.val(),
                    organismoRaiz: "" == $selectOrganismosRaiz.val() ? null : $selectOrganismosRaiz.val(), idOrganoEmisor: "" == $selectOrganismosEmisores.val() ? null : $selectOrganismosEmisores.val(), asunto: "" == $selectAsuntos.val() ? null : $selectAsuntos.val(), idGrupo: "" == $selectGrupos.val() ? null : $selectGrupos.val(), fechaDesde: "" == $fechaDesde.val() ? null : $fechaDesde.val(), fechaHasta: "" == $fechaHasta.val() ? null : $fechaHasta.val()
                }, setTimeout(g, 1, b)); $("#overlay").show()
        }); $("#btn-limpiar").click(function (b) {
            $("#inputIdentificador")[0].value =
            ""; $("#selectAdministracionPublica").selectpicker("val", ""); cargarSelectOrganismoRaiz(""); cargarSelectOrganismosEmisores(""); $("#selectEstados").selectpicker("val", ""); $("#selectAsuntos").selectpicker("val", ""); $("#selectGrupos").selectpicker("val", ""); $("#fechaDesde")[0].value = ""; $("#fechaHasta")[0].value = ""
        }); $("#table").on("dbl-click-cell.bs.table", function (b, e, f, a) {
            window.location.href = a.EstadosEnvio.ID != Estados.Leidas ? "../Comunicaciones/ComunicacionDetalle?identificador=" + a.Identificador + "&c=0" :
                "../Comunicaciones/ComunicacionLeida?identificador=" + a.Identificador
        }); $("#btn-agregar-grupo").click(function (b) {
            b = $("#selectGruposModal").val(); if ("" != b) {
                for (var e = 1, f = document.querySelectorAll("#gruposAsignados li"), a = 0; li = f[a]; a++)li.id == b && (e = 0); 1 == e && $.ajax({
                    async: !1, type: "GET", contentType: "application/json; charset=utf-8", url: "/Base/GetGrupoById", data: { idGrupo: b }, dataType: "json", success: function (d) {
                        $("#gruposAsignados").append("<li id='" + d.ID + "'><strong class='eliminar-grupo' title='Quitar' onclick=\"javascript:eliminarGrupoAsignado('" +
                            d.ID + "')\">X</strong>" + d.Nombre + "</li>")
                    }, error: function (d) { toastr.error("Error en la llamada al servicio 'GetGrupoById'") }
                })
            }
        }); $("#btn-guardar-grupos").click(function (b) { b.preventDefault(); $("#asignarGrupoModal").modal("hide"); setTimeout(k, 1); $("#overlay").show() })
    })
});